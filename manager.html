<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BackWerk Manager Dashboard - Time Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .company-logo {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .header-text h1 {
            font-size: 28px;
            font-weight: 800;
            color: #333;
            margin-bottom: 5px;
        }

        .header-text p {
            color: #666;
            font-size: 14px;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #00c851 0%, #007e33 100%);
            color: white;
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #e9ecef;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-card {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .store-card {
            border-left: 5px solid #ff6b6b;
        }

        .store-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .store-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .store-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .employee-list {
            margin-top: 15px;
        }

        .employee-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.2s ease;
        }

        .employee-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .employee-name {
            font-weight: 600;
            color: #333;
        }

        .employee-hours {
            color: #666;
            font-size: 14px;
        }

        .recent-entries {
            max-height: 400px;
            overflow-y: auto;
        }

        .entry-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s ease;
        }

        .entry-item:hover {
            background: #f8f9fa;
        }

        .entry-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .entry-employee {
            font-weight: 600;
            color: #333;
        }

        .entry-details {
            font-size: 14px;
            color: #666;
        }

        .entry-hours {
            font-weight: bold;
            color: #28a745;
            font-size: 16px;
        }

        .charts-section {
            margin-top: 30px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .form-input {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .reports-section {
            margin-top: 30px;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid #17a2b8;
        }

        .loading {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid #ccc;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-content">
                <div class="header-title">
                    <div class="company-logo">BW</div>
                    <div class="header-text">
                        <h1>BackWerk Manager Dashboard</h1>
                        <p>Real-time employee time tracking and management</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="refreshDashboard()">
                        <span id="refreshText">ðŸ”„ Refresh</span>
                    </button>
                    <button class="btn btn-primary" onclick="openAddEmployeeModal()">
                        ðŸ‘¤ Add Employee
                    </button>
                    <button class="btn btn-success" onclick="exportReports()">
                        ðŸ“Š Export Reports
                    </button>
                </div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <div class="controls-grid">
                <div class="form-group">
                    <label class="form-label">Filter by Store</label>
                    <select id="storeFilter" class="form-input" onchange="filterByStore()">
                        <option value="">All Stores</option>
                        <option value="BackWerk Frankenthal">BackWerk Frankenthal</option>
                        <option value="BackWerk Offenburg">BackWerk Offenburg</option>
                        <option value="BackWerk Karlsruhe">BackWerk Karlsruhe</option>
                        <option value="Back-Factory Karlsruhe">Back-Factory Karlsruhe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Date From</label>
                    <input type="date" id="dateFrom" class="form-input" onchange="filterByDate()">
                </div>
                <div class="form-group">
                    <label class="form-label">Date To</label>
                    <input type="date" id="dateTo" class="form-input" onchange="filterByDate()">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Stats -->
        <div class="dashboard-grid">
            <div class="card stat-card">
                <div class="stat-number" id="totalEmployees">0</div>
                <div class="stat-label">Total Employees</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="activeToday">0</div>
                <div class="stat-label">Active Today</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="totalHoursWeek">0</div>
                <div class="stat-label">Hours This Week</div>
            </div>
            <div class="card stat-card">
                <div class="stat-number" id="totalHoursMonth">0</div>
                <div class="stat-label">Hours This Month</div>
            </div>
        </div>

        <!-- Store Overview -->
        <div class="dashboard-grid" id="storeOverview">
            <!-- Store cards will be dynamically generated -->
        </div>

        <!-- Recent Activity & Charts -->
        <div class="charts-grid">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ðŸ“‹ Recent Time Entries</h3>
                    <button class="btn btn-secondary" onclick="refreshRecentEntries()">Refresh</button>
                </div>
                <div class="recent-entries" id="recentEntries">
                    <!-- Recent entries will be loaded here -->
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">ðŸ“ˆ Weekly Hours Trend</h3>
                </div>
                <div class="chart-container">
                    <canvas id="weeklyChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- Detailed Reports Table -->
        <div class="reports-section">
            <div class="table-container">
                <div class="card-header">
                    <h3 class="card-title">ðŸ“Š Detailed Time Records</h3>
                    <div>
                        <button class="btn btn-secondary" onclick="toggleTableView()">Toggle View</button>
                        <button class="btn btn-primary" onclick="exportTableData()">Export CSV</button>
                    </div>
                </div>
                <table class="data-table" id="detailedTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Store</th>
                            <th>Employee</th>
                            <th>Start Time</th>
                            <th>End Time</th>
                            <th>Hours</th>
                            <th>Submitted By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Employee Modal -->
    <div id="addEmployeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add New Employee</h3>
                <button class="close-btn" onclick="closeModal('addEmployeeModal')">&times;</button>
            </div>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label class="form-label">Employee Name</label>
                    <input type="text" id="newEmployeeName" class="form-input" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Store</label>
                    <select id="newEmployeeStore" class="form-input" required>
                        <option value="">Select Store</option>
                        <option value="BackWerk Frankenthal">BackWerk Frankenthal</option>
                        <option value="BackWerk Offenburg">BackWerk Offenburg</option>
                        <option value="BackWerk Karlsruhe">BackWerk Karlsruhe</option>
                        <option value="Back-Factory Karlsruhe">Back-Factory Karlsruhe</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" id="newEmployeeStartDate" class="form-input" required>
                </div>
                <div class="form-group" style="margin-top: 25px;">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        Add Employee
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="alertContainer"></div>

    <script>
        // Configuration - Update these with your actual URLs
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw8SHqhj-H7ooxZT5TXGzZfZPWvcgcCMkskdN2rQDLmRGI_qmqpw5YQx6PIx_rCt6cJxA/exec';
        const GOOGLE_SHEET_URL = 'https://docs.google.com/spreadsheets/d/1IqsqN8FwBb-uejbyUtkkCAXlJaikrQUWj_LgbVoseRM/edit';

        // Store configuration
        const STORES = {
            'BackWerk Frankenthal': {
                employees: ['Waqas', 'Yan', 'Gizem', 'Irfan', 'Najat', 'Atta', 'Ayesha', 'Melek'],
                color: '#ff6b6b'
            },
            'BackWerk Offenburg': {
                employees: ['Shazia', 'Kamran', 'Hussain', 'Mohan', 'Nilab', 'Nandini'],
                color: '#4ecdc4'
            },
            'BackWerk Karlsruhe': {
                employees: ['Furqan', 'Hamza', 'Dilpreet', 'Yaseen'],
                color: '#45b7d1'
            },
            'Back-Factory Karlsruhe': {
                employees: ['Nabeel', 'Lubna', 'Nosheen', 'Rabia'],
                color: '#feca57'
            }
        };

        // Global variables
        let dashboardData = {
            timeRecords: [],
            employees: [],
            stores: Object.keys(STORES)
        };

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            generateSampleData();
            updateDashboard();
            
            // Set default date range (last 30 days)
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getTime() - (30 * 24 * 60 * 60 * 1000));
            
            document.getElementById('dateTo').value = today.toISOString().split('T')[0];
            document.getElementById('dateFrom').value = thirtyDaysAgo.toISOString().split('T')[0];
        });

        function initializeDashboard() {
            console.log('Initializing Manager Dashboard...');
            loadDashboardData();
        }

        function generateSampleData() {
            // Generate sample time records for demonstration
            const sampleData = [];
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today.getTime() - (i * 24 * 60 * 60 * 1000));
                const dateString = date.toISOString().split('T')[0];
                
                Object.keys(STORES).forEach(storeName => {
                    const employees = STORES[storeName].employees;
                    
                    // Random number of employees working each day
                    const workingEmployees = employees.slice(0, Math.floor(Math.random() * employees.length) + 1);
                    
                    workingEmployees.forEach(employee => {
                        if (Math.random() > 0.3) { // 70% chance of working
                            const startHour = 8 + Math.floor(Math.random() * 3);
                            const endHour = startHour + 8 + Math.floor(Math.random() * 2);
                            const hours = endHour - startHour + (Math.random() * 0.8 - 0.4);
                            
                            sampleData.push({
                                id: `sample_${Date.now()}_${Math.random()}`,
                                date: dateString,
                                store: storeName,
                                employee: employee,
                                startTime: `${startHour.toString().padStart(2, '0')}:00`,
                                endTime: `${endHour.toString().padStart(2, '0')}:00`,
                                hoursWorked: hours.toFixed(2),
                                submittedBy: 'Manager',
                                submittedAt: new Date().toISOString(),
                                timestamp: new Date().toLocaleString('de-DE')
                            });
                        }
                    });
                });
            }
            
            dashboardData.timeRecords = sampleData;
        }

        async function loadDashboardData() {
            try {
                showAlert('Loading dashboard data...', 'info');
                
                // In a real implementation, this would fetch from the Google Sheets API
                // For now, we'll use the sample data
                
                updateDashboardStats();
                updateStoreOverview();
                updateRecentEntries();
                updateDetailedTable();
                
                showAlert('Dashboard loaded successfully!', 'success');
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showAlert('Error loading dashboard data. Using sample data.', 'error');
            }
        }

        function updateDashboardStats() {
            const records = dashboardData.timeRecords;
            const today = new Date().toISOString().split('T')[0];
            const thisWeekStart = getWeekStart(new Date());
            const thisMonthStart = new Date(new Date().getFullYear(), new Date().getMonth(), 1);
            
            // Total employees
            const totalEmployees = Object.values(STORES).reduce((sum, store) => sum + store.employees.length, 0);
            document.getElementById('totalEmployees').textContent = totalEmployees;
            
            // Active today
            const activeToday = new Set(records.filter(r => r.date === today).map(r => r.employee)).size;
            document.getElementById('activeToday').textContent = activeToday;
            
            // Hours this week
            const weeklyHours = records
                .filter(r => new Date(r.date) >= thisWeekStart)
                .reduce((sum, r) => sum + parseFloat(r.hoursWorked), 0);
            document.getElementById('totalHoursWeek').textContent = Math.round(weeklyHours);
            
            // Hours this month
            const monthlyHours = records
                .filter(r => new Date(r.date) >= thisMonthStart)
                .reduce((sum, r) => sum + parseFloat(r.hoursWorked), 0);
            document.getElementById('totalHoursMonth').textContent = Math.round(monthlyHours);
        }

        function updateStoreOverview() {
            const container = document.getElementById('storeOverview');
            container.innerHTML = '';
            
            Object.keys(STORES).forEach(storeName => {
                const storeData = STORES[storeName];
                const storeRecords = dashboardData.timeRecords.filter(r => r.store === storeName);
                const today = new Date().toISOString().split('T')[0];
                const activeToday = new Set(storeRecords.filter(r => r.date === today).map(r => r.employee)).size;
                
                const storeCard = document.createElement('div');
                storeCard.className = 'card store-card';
                storeCard.style.borderLeftColor = storeData.color;
                
                storeCard.innerHTML = `
                    <div class="store-header">
                        <div class="store-name">${storeName}</div>
                        <div class="store-status status-active">Active</div>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: ${storeData.color};">
                                ${storeData.employees.length}
                            </div>
                            <div style="font-size: 12px; color: #666;">Total Employees</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;">
                                ${activeToday}
                            </div>
                            <div style="font-size: 12px; color: #666;">Active Today</div>
                        </div>
                    </div>
                    <div class="employee-list">
                        ${storeData.employees.map(emp => {
                            const empRecords = storeRecords.filter(r => r.employee === emp);
                            const thisWeekHours = empRecords
                                .filter(r => new Date(r.date) >= getWeekStart(new Date()))
                                .reduce((sum, r) => sum + parseFloat(r.hoursWorked), 0);
                            
                            return `
                                <div class="employee-item">
                                    <span class="employee-name">${emp}</span>
                                    <span class="employee-hours">${thisWeekHours.toFixed(1)}h this week</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <button class="btn btn-primary" style="width: 100%; margin-top: 15px;" onclick="viewStoreDetails('${storeName}')">
                        View Details
                    </button>
                `;
                
                container.appendChild(storeCard);
            });
        }

        function updateRecentEntries() {
            const container = document.getElementById('recentEntries');
            const recentRecords = dashboardData.timeRecords
                .sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt))
                .slice(0, 10);
            
            if (recentRecords.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No recent entries found</div>';
                return;
            }
            
            container.innerHTML = recentRecords.map(record => `
                <div class="entry-item">
                    <div class="entry-info">
                        <div class="entry-employee">${record.employee} - ${record.store}</div>
                        <div class="entry-details">${record.date} | ${record.startTime} - ${record.endTime}</div>
                    </div>
                    <div class="entry-hours">${record.hoursWorked}h</div>
                </div>
            `).join('');
        }

        function updateDetailedTable() {
            const tbody = document.getElementById('tableBody');
            const records = dashboardData.timeRecords
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 50); // Show last 50 records
            
            tbody.innerHTML = records.map(record => `
                <tr>
                    <td>${new Date(record.date).toLocaleDateString('de-DE')}</td>
                    <td>${record.store}</td>
                    <td>${record.employee}</td>
                    <td>${record.startTime}</td>
                    <td>${record.endTime}</td>
                    <td><strong>${record.hoursWorked}h</strong></td>
                    <td>${record.submittedBy}</td>
                    <td>
                        <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="editEntry('${record.id}')">Edit</button>
                        <button class="btn" style="padding: 4px 8px; font-size: 12px; background: #dc3545; color: white;" onclick="deleteEntry('${record.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        // Dashboard Actions
        function refreshDashboard() {
            const refreshText = document.getElementById('refreshText');
            refreshText.innerHTML = '<span class="loading"><span class="spinner"></span>Refreshing...</span>';
            
            setTimeout(() => {
                loadDashboardData();
                refreshText.innerHTML = 'ðŸ”„ Refresh';
            }, 2000);
        }

        function refreshRecentEntries() {
            updateRecentEntries();
            showAlert('Recent entries refreshed!', 'success');
        }

        // Filtering Functions
        function filterByStore() {
            const selectedStore = document.getElementById('storeFilter').value;
            // Implementation would filter the data and update displays
            updateDetailedTable();
            showAlert(selectedStore ? `Filtered by ${selectedStore}` : 'Filter cleared', 'info');
        }

        function filterByDate() {
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            if (dateFrom && dateTo && dateFrom > dateTo) {
                showAlert('Start date cannot be after end date!', 'error');
                return;
            }
            
            // Implementation would filter data by date range
            updateDetailedTable();
            showAlert('Date filter applied', 'info');
        }

        // Report Generation
        function generateReport() {
            const store = document.getElementById('storeFilter').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let filteredData = dashboardData.timeRecords;
            
            if (store) {
                filteredData = filteredData.filter(r => r.store === store);
            }
            
            if (dateFrom) {
                filteredData = filteredData.filter(r => r.date >= dateFrom);
            }
            
            if (dateTo) {
                filteredData = filteredData.filter(r => r.date <= dateTo);
            }
            
            showAlert(`Report generated with ${filteredData.length} records`, 'success');
            
            // Generate summary statistics
            const totalHours = filteredData.reduce((sum, r) => sum + parseFloat(r.hoursWorked), 0);
            const uniqueEmployees = new Set(filteredData.map(r => r.employee)).size;
            const averageHours = uniqueEmployees > 0 ? (totalHours / uniqueEmployees).toFixed(2) : 0;
            
            console.log('Report Summary:', {
                totalRecords: filteredData.length,
                totalHours: totalHours.toFixed(2),
                uniqueEmployees,
                averageHours,
                dateRange: `${dateFrom || 'All'} to ${dateTo || 'All'}`,
                store: store || 'All Stores'
            });
        }

        function exportReports() {
            const data = dashboardData.timeRecords;
            const csvContent = generateCSVContent(data);
            downloadCSV(csvContent, 'backwerk_time_report.csv');
            showAlert('Report exported successfully!', 'success');
        }

        function exportTableData() {
            const visibleData = dashboardData.timeRecords.slice(0, 50);
            const csvContent = generateCSVContent(visibleData);
            downloadCSV(csvContent, 'backwerk_detailed_report.csv');
            showAlert('Table data exported!', 'success');
        }

        function generateCSVContent(data) {
            const headers = ['Date', 'Store', 'Employee', 'Start Time', 'End Time', 'Hours Worked', 'Submitted By', 'Submitted At'];
            const rows = data.map(record => [
                record.date,
                record.store,
                record.employee,
                record.startTime,
                record.endTime,
                record.hoursWorked,
                record.submittedBy,
                record.timestamp
            ]);
            
            return [headers, ...rows].map(row => row.join(',')).join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Modal Functions
        function openAddEmployeeModal() {
            document.getElementById('addEmployeeModal').style.display = 'block';
            document.getElementById('newEmployeeStartDate').value = new Date().toISOString().split('T')[0];
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            
            // Reset form if it's the add employee modal
            if (modalId === 'addEmployeeModal') {
                document.getElementById('addEmployeeForm').reset();
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }

        // Handle add employee form submission
        document.getElementById('addEmployeeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('newEmployeeName').value;
            const store = document.getElementById('newEmployeeStore').value;
            const startDate = document.getElementById('newEmployeeStartDate').value;
            
            if (!name || !store || !startDate) {
                showAlert('Please fill in all fields!', 'error');
                return;
            }
            
            // Add employee to store configuration
            if (STORES[store] && !STORES[store].employees.includes(name)) {
                STORES[store].employees.push(name);
                updateStoreOverview();
                updateDashboardStats();
                showAlert(`Employee ${name} added to ${store} successfully!`, 'success');
                closeModal('addEmployeeModal');
            } else {
                showAlert('Employee already exists in this store!', 'error');
            }
        });

        // Entry Actions
        function editEntry(entryId) {
            const entry = dashboardData.timeRecords.find(r => r.id === entryId);
            if (entry) {
                // In a real implementation, this would open an edit modal
                const newHours = prompt(`Edit hours worked for ${entry.employee} on ${entry.date}:`, entry.hoursWorked);
                if (newHours && !isNaN(newHours) && parseFloat(newHours) > 0) {
                    entry.hoursWorked = parseFloat(newHours).toFixed(2);
                    updateDetailedTable();
                    updateDashboardStats();
                    showAlert('Entry updated successfully!', 'success');
                }
            }
        }

        function deleteEntry(entryId) {
            if (confirm('Are you sure you want to delete this time entry?')) {
                dashboardData.timeRecords = dashboardData.timeRecords.filter(r => r.id !== entryId);
                updateDetailedTable();
                updateRecentEntries();
                updateDashboardStats();
                showAlert('Entry deleted successfully!', 'success');
            }
        }

        function viewStoreDetails(storeName) {
            // Filter to show only this store's data
            document.getElementById('storeFilter').value = storeName;
            filterByStore();
            
            // Scroll to detailed table
            document.querySelector('.reports-section').scrollIntoView({ behavior: 'smooth' });
        }

        // Utility Functions
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Adjust when day is sunday
            return new Date(d.setDate(diff));
        }

        function toggleTableView() {
            const table = document.getElementById('detailedTable');
            const isHidden = table.classList.contains('hidden');
            
            if (isHidden) {
                table.classList.remove('hidden');
                showAlert('Table view restored', 'info');
            } else {
                table.classList.add('hidden');
                showAlert('Table view hidden', 'info');
            }
        }

        function showAlert(message, type) {
            const container = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '9999';
            alert.style.minWidth = '300px';
            alert.style.animation = 'slideInRight 0.3s ease';
            
            container.appendChild(alert);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.style.animation = 'slideOutRight 0.3s ease';
                    setTimeout(() => {
                        if (alert.parentNode) {
                            container.removeChild(alert);
                        }
                    }, 300);
                }
            }, 4000);
        }

        // Initial dashboard update
        function updateDashboard() {
            updateDashboardStats();
            updateStoreOverview();
            updateRecentEntries();
            updateDetailedTable();
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            @keyframes slideOutRight {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        // Auto-refresh dashboard every 5 minutes
        setInterval(() => {
            console.log('Auto-refreshing dashboard...');
            loadDashboardData();
        }, 5 * 60 * 1000);

    </script>
</body>
</html>