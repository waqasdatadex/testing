<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BackWerk Employee - Quick Time Entry</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 0;
            color: #333;
            overflow-x: hidden;
        }

        .mobile-container {
            max-width: 100vw;
            min-height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .mobile-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: max(env(safe-area-inset-top), 20px) 20px 20px;
            text-align: center;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.15);
        }

        .app-title {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .app-subtitle {
            font-size: 14px;
            opacity: 0.9;
            font-weight: 400;
        }

        .content-area {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .quick-login {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 15px;
            font-size: 18px;
            background: #f8f9fa;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-input:focus {
            outline: none;
            border-color: #ff6b6b;
            background: white;
            box-shadow: 0 0 0 4px rgba(255, 107, 107, 0.1);
        }

        .mobile-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(58, 123, 213, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 65, 108, 0.3);
        }

        .mobile-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .mobile-btn:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .action-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .action-card:active {
            transform: scale(0.95);
        }

        .action-card.active {
            border-color: #ff6b6b;
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.2);
        }

        .action-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .action-title {
            font-weight: 700;
            color: #333;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .action-subtitle {
            font-size: 12px;
            color: #666;
        }

        .time-display {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 8px 30px rgba(52, 152, 219, 0.3);
        }

        .current-time {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .current-date {
            font-size: 16px;
            opacity: 0.9;
        }

        .work-session {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }

        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .session-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .session-duration {
            font-size: 24px;
            font-weight: bold;
            color: #27ae60;
            font-family: 'SF Mono', Monaco, monospace;
        }

        .session-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .detail-item {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
        }

        .detail-value {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .detail-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            font-weight: 600;
        }

        .recent-entries {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }

        .entries-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .entries-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .entry-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .entry-item:last-child {
            border-bottom: none;
        }

        .entry-date {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .entry-time {
            font-size: 14px;
            color: #666;
        }

        .entry-hours {
            font-weight: bold;
            color: #27ae60;
            font-size: 18px;
        }

        .status-message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            display: none;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .bottom-nav {
            background: white;
            padding: 15px 20px max(env(safe-area-inset-bottom), 15px);
            border-top: 1px solid #eee;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .nav-btn {
            padding: 12px;
            background: #f8f9fa;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .nav-btn.active {
            background: #ff6b6b;
            color: white;
        }

        .nav-btn:active {
            transform: scale(0.95);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 360px) {
            .content-area {
                padding: 15px;
            }
            
            .current-time {
                font-size: 28px;
            }
            
            .session-duration {
                font-size: 20px;
            }
        }

        /* iOS specific styles */
        @supports (-webkit-touch-callout: none) {
            .mobile-container {
                min-height: 100vh;
                min-height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <div class="mobile-header">
            <div class="app-title">BackWerk</div>
            <div class="app-subtitle">Employee Time Tracker</div>
        </div>

        <div class="content-area">
            <!-- Login Page -->
            <div id="loginPage" class="page active">
                <div class="quick-login">
                    <div class="form-group">
                        <label class="form-label">Employee Name</label>
                        <input type="text" id="employeeName" class="form-input" placeholder="Enter your name" autocomplete="username">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Store Location</label>
                        <select id="storeSelect" class="form-input">
                            <option value="">Select Store</option>
                            <option value="BackWerk Frankenthal">BackWerk Frankenthal</option>
                            <option value="BackWerk Offenburg">BackWerk Offenburg</option>
                            <option value="BackWerk Karlsruhe">BackWerk Karlsruhe</option>
                            <option value="Back-Factory Karlsruhe">Back-Factory Karlsruhe</option>
                        </select>
                    </div>
                    
                    <button class="mobile-btn btn-primary" onclick="quickLogin()" id="loginBtn">
                        Start Working
                    </button>
                </div>
                
                <div class="status-message" id="loginStatus"></div>
            </div>

            <!-- Main App Page -->
            <div id="mainPage" class="page">
                <div class="time-display">
                    <div class="current-time" id="currentTime">00:00:00</div>
                    <div class="current-date" id="currentDate">Loading...</div>
                </div>

                <div class="quick-actions">
                    <div class="action-card" id="clockInCard" onclick="clockIn()">
                        <span class="action-icon">🕐</span>
                        <div class="action-title">Clock In</div>
                        <div class="action-subtitle">Start your shift</div>
                    </div>
                    
                    <div class="action-card" id="clockOutCard" onclick="clockOut()">
                        <span class="action-icon">🕕</span>
                        <div class="action-title">Clock Out</div>
                        <div class="action-subtitle">End your shift</div>
                    </div>
                </div>

                <div class="work-session" id="workSession" style="display: none;">
                    <div class="session-header">
                        <div class="session-title">Current Shift</div>
                        <div class="session-duration" id="sessionDuration">0:00</div>
                    </div>
                    
                    <div class="session-details">
                        <div class="detail-item">
                            <div class="detail-value" id="startTime">--:--</div>
                            <div class="detail-label">Started</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-value" id="currentHours">0.0h</div>
                            <div class="detail-label">Hours</div>
                        </div>
                    </div>
                </div>

                <div class="status-message" id="mainStatus"></div>
            </div>

            <!-- History Page -->
            <div id="historyPage" class="page">
                <div class="recent-entries">
                    <div class="entries-header">
                        <div class="entries-title">Recent Shifts</div>
                        <button class="nav-btn" onclick="refreshHistory()">Refresh</button>
                    </div>
                    <div id="entriesList">
                        <div style="text-align: center; padding: 20px; color: #666;">
                            No recent entries found
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <button class="nav-btn" onclick="showPage('mainPage')" id="mainNavBtn">Clock</button>
            <button class="nav-btn" onclick="showPage('historyPage')" id="historyNavBtn">History</button>
            <button class="nav-btn" onclick="logout()" id="logoutNavBtn">Logout</button>
        </div>
    </div>

    <script>
        // Configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw-hV6nIZNmM8sp6PY-DFw2PCdcBi8Dr--geTyvxbXJP8dNIqOWmdA-kM-n2st-duWHxg/exec';

        // App state
        let currentUser = null;
        let currentShift = null;
        let shiftTimer = null;
        let timeEntries = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            loadStoredData();
            
            // Auto-focus on name input
            document.getElementById('employeeName').focus();
        });

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            const dateString = now.toLocaleDateString('de-DE', {
                weekday: 'long',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
            
            document.getElementById('currentTime').textContent = timeString;
            document.getElementById('currentDate').textContent = dateString;
        }

        function quickLogin() {
            const name = document.getElementById('employeeName').value.trim();
            const store = document.getElementById('storeSelect').value;
            
            if (!name || !store) {
                showStatus('loginStatus', 'Please enter your name and select a store', 'error');
                return;
            }
            
            currentUser = {
                name: name,
                store: store,
                loginTime: new Date().toISOString()
            };
            
            // Store user data
            localStorage.setItem('backwerk_user', JSON.stringify(currentUser));
            
            showStatus('loginStatus', `Welcome, ${name}!`, 'success');
            
            setTimeout(() => {
                document.getElementById('loginPage').classList.remove('active');
                document.getElementById('mainPage').classList.add('active');
                document.getElementById('mainNavBtn').classList.add('active');
            }, 1000);
        }

        function clockIn() {
            if (currentShift) {
                showStatus('mainStatus', 'You are already clocked in!', 'error');
                return;
            }
            
            const now = new Date();
            currentShift = {
                employee: currentUser.name,
                store: currentUser.store,
                startTime: now.toTimeString().slice(0, 5),
                startDateTime: now.toISOString(),
                date: now.toISOString().split('T')[0]
            };
            
            // Update UI
            document.getElementById('clockInCard').classList.add('active');
            document.getElementById('workSession').style.display = 'block';
            document.getElementById('startTime').textContent = currentShift.startTime;
            
            // Start timer
            startShiftTimer();
            
            // Store shift data
            localStorage.setItem('backwerk_current_shift', JSON.stringify(currentShift));
            
            showStatus('mainStatus', `Clocked in at ${currentShift.startTime}`, 'success');
        }

        function clockOut() {
            if (!currentShift) {
                showStatus('mainStatus', 'You need to clock in first!', 'error');
                return;
            }
            
            const now = new Date();
            const endTime = now.toTimeString().slice(0, 5);
            const startDateTime = new Date(currentShift.startDateTime);
            const hoursWorked = ((now - startDateTime) / (1000 * 60 * 60)).toFixed(2);
            
            // Complete the shift record
            const completedShift = {
                ...currentShift,
                endTime: endTime,
                hoursWorked: hoursWorked,
                submittedAt: now.toISOString(),
                submittedBy: currentUser.name,
                id: 'mobile_' + Date.now()
            };
            
            // Submit to backend
            submitTimeEntry(completedShift);
            
            // Store locally
            timeEntries.push(completedShift);
            localStorage.setItem('backwerk_time_entries', JSON.stringify(timeEntries));
            
            // Clean up current shift
            currentShift = null;
            clearInterval(shiftTimer);
            localStorage.removeItem('backwerk_current_shift');
            
            // Update UI
            document.getElementById('clockInCard').classList.remove('active');
            document.getElementById('clockOutCard').classList.remove('active');
            document.getElementById('workSession').style.display = 'none';
            
            showStatus('mainStatus', `Clocked out! Worked ${hoursWorked} hours`, 'success');
            updateHistoryDisplay();
        }

        function startShiftTimer() {
            shiftTimer = setInterval(() => {
                if (currentShift) {
                    const now = new Date();
                    const startDateTime = new Date(currentShift.startDateTime);
                    const elapsed = now - startDateTime;
                    
                    const hours = Math.floor(elapsed / (1000 * 60 * 60));
                    const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((elapsed % (1000 * 60)) / 1000);
                    
                    const duration = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    const hoursDecimal = (elapsed / (1000 * 60 * 60)).toFixed(1);
                    
                    document.getElementById('sessionDuration').textContent = duration;
                    document.getElementById('currentHours').textContent = `${hoursDecimal}h`;
                }
            }, 1000);
        }

        async function submitTimeEntry(timeEntry) {
            try {
                if (!GOOGLE_SCRIPT_URL.includes('script.google.com')) {
                    console.log('Demo mode - entry saved locally:', timeEntry);
                    return;
                }
                
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addTimeEntry',
                        data: timeEntry
                    }),
                    mode: 'no-cors'
                });
                
                console.log('Time entry submitted successfully');
            } catch (error) {
                console.error('Error submitting time entry:', error);
                // Entry is still saved locally as fallback
            }
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Activate corresponding nav button
            if (pageId === 'mainPage') {
                document.getElementById('mainNavBtn').classList.add('active');
            } else if (pageId === 'historyPage') {
                document.getElementById('historyNavBtn').classList.add('active');
                updateHistoryDisplay();
            }
        }

        function updateHistoryDisplay() {
            const entriesList = document.getElementById('entriesList');
            
            if (timeEntries.length === 0) {
                entriesList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        No recent entries found
                    </div>
                `;
                return;
            }
            
            // Sort by date (newest first) and show last 10
            const recentEntries = timeEntries
                .sort((a, b) => new Date(b.submittedAt) - new Date(a.submittedAt))
                .slice(0, 10);
            
            entriesList.innerHTML = recentEntries.map(entry => {
                const date = new Date(entry.date).toLocaleDateString('de-DE', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit'
                });
                
                return `
                    <div class="entry-item">
                        <div>
                            <div class="entry-date">${date}</div>
                            <div class="entry-time">${entry.startTime} - ${entry.endTime}</div>
                        </div>
                        <div class="entry-hours">${entry.hoursWorked}h</div>
                    </div>
                `;
            }).join('');
        }

        function refreshHistory() {
            updateHistoryDisplay();
            showStatus('mainStatus', 'History refreshed', 'info');
        }

        function logout() {
            if (currentShift && confirm('You have an active shift. Are you sure you want to logout?')) {
                // Force clock out
                clockOut();
            }
            
            // Clear all stored data
            localStorage.removeItem('backwerk_user');
            localStorage.removeItem('backwerk_current_shift');
            
            // Reset state
            currentUser = null;
            currentShift = null;
            if (shiftTimer) clearInterval(shiftTimer);
            
            // Reset form
            document.getElementById('employeeName').value = '';
            document.getElementById('storeSelect').value = '';
            
            // Show login page
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById('loginPage').classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            showStatus('loginStatus', 'Logged out successfully', 'info');
        }

        function loadStoredData() {
            // Load user data
            const storedUser = localStorage.getItem('backwerk_user');
            if (storedUser) {
                currentUser = JSON.parse(storedUser);
                
                // Auto-login if user data exists
                document.getElementById('loginPage').classList.remove('active');
                document.getElementById('mainPage').classList.add('active');
                document.getElementById('mainNavBtn').classList.add('active');
            }
            
            // Load current shift
            const storedShift = localStorage.getItem('backwerk_current_shift');
            if (storedShift && currentUser) {
                currentShift = JSON.parse(storedShift);
                
                // Restore shift UI
                document.getElementById('clockInCard').classList.add('active');
                document.getElementById('workSession').style.display = 'block';
                document.getElementById('startTime').textContent = currentShift.startTime;
                
                startShiftTimer();
            }
            
            // Load time entries
            const storedEntries = localStorage.getItem('backwerk_time_entries');
            if (storedEntries) {
                timeEntries = JSON.parse(storedEntries);
            }
        }

        function showStatus(elementId, message, type) {
            const statusElement = document.getElementById(elementId);
            statusElement.textContent = message;
            statusElement.className = `status-message status-${type}`;
            statusElement.style.display = 'block';
            
            // Auto-hide after 4 seconds
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 4000);
        }

        // Handle page visibility change (for mobile browsers)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && currentShift) {
                // Resume timer when page becomes visible
                startShiftTimer();
            }
        });

        // Prevent accidental navigation away
        window.addEventListener('beforeunload', function(e) {
            if (currentShift) {
                e.preventDefault();
                e.returnValue = 'You have an active shift. Are you sure you want to leave?';
            }
        });

        // Add keyboard shortcuts for quick actions
        document.addEventListener('keydown', function(e) {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') return;
            
            switch(e.key) {
                case '1':
                    if (document.getElementById('mainPage').classList.contains('active')) {
                        clockIn();
                    }
                    break;
                case '2':
                    if (document.getElementById('mainPage').classList.contains('active')) {
                        clockOut();
                    }
                    break;
                case '3':
                    showPage('historyPage');
                    break;
            }
        });

        // Add some demo data for testing
        function addDemoData() {
            const demoEntries = [
                {
                    id: 'demo_1',
                    employee: currentUser?.name || 'Demo User',
                    store: currentUser?.store || 'Demo Store',
                    date: new Date().toISOString().split('T')[0],
                    startTime: '09:00',
                    endTime: '17:00',
                    hoursWorked: '8.0',
                    submittedAt: new Date().toISOString(),
                    submittedBy: 'Mobile App'
                },
                {
                    id: 'demo_2',
                    employee: currentUser?.name || 'Demo User',
                    store: currentUser?.store || 'Demo Store',
                    date: new Date(Date.now() - 24*60*60*1000).toISOString().split('T')[0],
                    startTime: '10:00',
                    endTime: '18:00',
                    hoursWorked: '8.0',
                    submittedAt: new Date(Date.now() - 24*60*60*1000).toISOString(),
                    submittedBy: 'Mobile App'
                }
            ];
            
            if (currentUser && timeEntries.length === 0) {
                timeEntries.push(...demoEntries);
                localStorage.setItem('backwerk_time_entries', JSON.stringify(timeEntries));
            }
        }

        // Initialize demo data after login
        setTimeout(() => {
            if (currentUser) {
                addDemoData();
            }
        }, 2000);

    </script>
</body>
</html>
